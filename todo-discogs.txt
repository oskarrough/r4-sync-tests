# Discogs Integration for R5

## Architecture
- Follow existing track_meta pattern (youtube_data, musicbrainz_data, discogs_data)
- Reuse track-meta.svelte component to automatically pull metadata
- Manual curation via discogs_url field on tracks (already handled in import logic)

## Implementation Steps

### 1. Database Schema [TODO]
- Add discogs_data, discogs_updated_at to track_meta table
- Add index for discogs_data JSONB queries
- Note: discogs_url already exists on tracks table + import logic

### 2. Sync Module [TODO] 
- Create /src/lib/sync/discogs.js
- Port R4's parseDiscogsUrl, fetchDiscogs utilities
- Follow pullMusicBrainz pattern for API integration
- Store full Discogs API response in discogs_data field

### 3. Component Integration [TODO]
- Update track-meta.svelte to include discogs data fetching
- Add discogs_data to hasMeta check and result object
- Automatic pull when track.discogs_url exists

### 4. Documentation [TODO]
- Update docs/track-meta.md to mention discogs
- Document the three-provider system

### 5. UI Enhancement [TODO]
- Add discogs_url input to track edit forms
- When user saves discogs_url, track-meta.svelte auto-fetches

## Data Flow
1. User adds discogs_url to track (manual curation)
2. track-meta.svelte detects discogs_url exists
3. pullDiscogs(ytid, discogs_url) fetches + stores metadata
4. Rich discogs data available in tracks_with_meta view

## Future Enhancements
- Auto-search discogs by title (like musicbrainz)
- Batch apply discogs_url to similar tracks in channel
- Suggest discogs releases based on existing metadata

## Auto-Discovery Chain (NEW)
- ✓ Proof of concept: ytid → musicbrainz → discogs works!
- ✓ Works best with "Artist - Title" format tracks
- TODO: Add to batch-edit page with "Discover Metadata" button
- TODO: Create background queue for processing tracks
- TODO: Optimize discovery function with better parsing

## Questions Resolved
- ✓ Use existing track_meta pattern (not separate discogs_releases table)
- ✓ Preserve manual curation signal via discogs_url on tracks
- ✓ Follow youtube/musicbrainz precedent for consistency
- ✓ Import logic already handles discogs_url field