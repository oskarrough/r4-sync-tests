# Todos

List of possible improvements to the architecture, idea, cli and web application.  
Always verify and evaluate todos before taking them on. They might be outdated or just not good ideas.

## Backlog

- group metadata enrichment functions (youtube, musicbrainz) under single namespace "metadata" instead of "sync" ?
- move sync/followers into lib/r5 namespace. think hard about the the pullFollowers logic. Maybe get rid of `syncFollowers`, we use "pull" naming in other places. Is it because it doesn't overwrite local, but merge into local? seems hard. hmm
- implement "queue" to the r5 api (low prio)
- Test we can export browser pglite and import and verify that
- adding a track (while on <slug>) doesn't re-render the tracklist
- consider integrating "bandsintown" as a third-party API similar to musicbrainz, youtube meta
- implement discogs (see components.radio4000.com, where it's already kinda done)
- change <slug>/page.js load function to maybe not block the whole page? too slow. render async islands nice svelte experimental async api pattern maybe?
- run `bun run check` and slowly get rid of these warnings
- v1 channels can't be bookmarked, they can't be broadcasted, because remote supabase doesn't know about their "foreign key".. ideas? r5 doesn't care whether it's v1 or v2, but remote postgres does. Maybe a system where the keys aren't proper ids, but just strings? That would allow you to store (in r4 remote postgres) channels that don't necessarily exist there, but only in v1. hmm
- there's an issue with the app state playlist and shuffled playlist. when the playlist is set, we need to make sure the shuffled one is derived from it. else they might up pointing to diff lists
- after adding a track the modal form resets, which is fine, but there's no clear ux to indicate that it was saved correctly. One idea is to add the <TrackCard> below. The r4-track-form thing must
- analyze https://svelte.dev/docs/svelte/$effect#When-not-to-use-$effect

## Arch improvements to consider

- implement event sourcing pattern: events table {type, payload, timestamp} for state changes, enables undo/replay
- unify sync layer: single sync_operations queue table instead of scattered pull/push functions
- refactor persistAppState() to use parameterized queries instead of string concatenation
- add validation layer at sync boundaries (remote->local) using lightweight lib like valibot
- implement backup/restore: export/import full pglite database as json or sql dump

ARCHITECTURE IMPROVEMENTS (MEDIUM PRIORITY)

- enhance logger: expose store.logs in devtools ui
- separate api layers: split ui operations (toggleTheme, openSearch) from data operations in api.js
- extract reusable debouncing utility instead of per-component implementation
- clarify data flow patterns - document and standardize when operations hit local vs remote database
- implement sync resumption - track sync progress in db, allow continuation of interrupted syncs
- create standardized loading/error boundaries for async operations in ui
- consolidate follower sync logic into single flow, remove complex local-user migration
- refactor broadcast architecture - remove module-level state, fix implicit dependencies, add cleanup on failures

TERMINOLOGY & API REFACTORS (from index.ts review)

- unify play actions: merge playTrack and playChannel into single play(entity)  -- why?
- move spam detection out of playground into proper module if keeping
- split utils by domain: youtube utils, text parsing utils, array utils
- standardize Channel vs Channels in function names (e.g., pullChannel vs pullChannels)

CLI & LLM INTEGRATION LEARNINGS

- search functionality works but needed better context understanding - improve CLI help/examples for complex queries  
- natural language search patterns unclear - document search operators (AND, OR, phrase matching) in CLI help
- verify we can write arbitrary sql queries locally??
- genre cross-analysis queries powerful but not obvious - add examples to CLI help
- LLM integration reveals rich semantic connections - consider exposing more metadata fields for search

HARD ONES, LOW PRIO

- the <youtube-player> fires volumechange seemingly at will, many times on load, which currently overwrites any appState.volume the user might already have. In other words, your volume preferences is persisted, but also overwritten on load
- find a way to share `track_meta` data between users. push it remote, how? security?

## CLI

- cli missing pieces (to be verified, do we event want/need this?)
  - Core download engine: yt-dlp integration, concurrent processing, file management
  - Progress system: @opentf/cli-pbar, ETA calculations, download statistics
  - Error handling: retry logic, download state tracking, failure persistence
  - File scanning: old CLI scans `<folder>/<slug>/tracks/*.m4a`, new CLI has no file ops
- cli: Better progress reporting with download speeds, concurrent status
- cli: Enhanced error messages with actionable recovery steps

